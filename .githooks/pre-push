#!/bin/sh

set -eu

if ! [ -x "$(command -v npm)" ]; then
  echo 'Error: npm not found. Make it available to the host shell (e.g., with "nvm use --lts").'
  exit 2
fi


reset() {
  echo "Restoring working tree"
  git stash pop
}

if [ -n "$(git status --porcelain)" ]; then
  echo "Working tree is not clean, temporary reset"
  git stash save --keep-index --include-untracked
  trap reset EXIT
fi

echo "Linting project (local mode)..."
npm run lint-local

command -v git-lfs >/dev/null 2>&1 || { echo >&2 "\nThis repository is configured for Git LFS but 'git-lfs' was not found on your path. If you no longer wish to use Git LFS, remove this hook by deleting '.git/hooks/pre-push'.\n"; exit 2; }
git lfs pre-push "$@"
